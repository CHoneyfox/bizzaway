{% extends "base.html" %}

{% block title %}Order Pizzas{% endblock %}

{% block content %}
  <section class="p-4 md:p-8 w-full md:w-3/4 mx-auto">
    <h1 class="text-2xl md:text-4xl font-semibold mb-4">Place Your Pizza Order</h1>
    <form action="{% url 'add_order' %}" method="post">
      {% csrf_token %}

      <!-- Name and Email -->
      <div class="mb-4">
        <label for="customer" class="block text-lg font-semibold">Name</label>
        <input type="text" id="customer" name="customer" class="w-full p-2 border border-gray-300 rounded-md" required>
      </div>

      <div class="mb-4">
        <label for="email" class="block text-lg font-semibold">Email</label>
        <input type="email" id="email" name="email" class="w-full p-2 border border-gray-300 rounded-md" required>
      </div>

      <!-- Pizza Selection -->
      <div class="mb-4">
        <label class="block text-lg font-semibold">Select Pizzas</label>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {% for pizza in pizzas %}
            <div class="border border-gray-200 p-4 rounded-md hover:shadow-lg transition duration-300 ease-in-out">
              <label class="flex items-center space-x-2">
                <input type="checkbox" name="selected_pizzas[]" value="{{ pizza.name }}">
                <span class="text-lg font-semibold">{{ pizza.name }}</span>
                <span class="text-gray-600 text-sm">€{{ pizza.price }}</span>
              </label>
            </div>
          {% endfor %}
        </div>
      </div>

        <!-- Total Price -->
        <div class="mb-4">
            <label for="total-price" class="block text-lg font-semibold">Total Price:</label>
            <span id="total-price">€0.00</span>
        </div>
  
  

      <!-- Notes -->
      <div class="mb-4">
        <label for="notes" class="block text-lg font-semibold">Additional Notes (Optional)</label>
        <textarea id="notes" name="notes" class="w-full p-2 border border-gray-300 rounded-md" rows="4"></textarea>
      </div>

      <button type="submit" class="bg-pizza-red text-white py-2 px-4 rounded-md hover:bg-pizza-red-dark transition duration-300 ease-in-out">
        Place Order
      </button>
    </form>
  </section>

  <script>
    // JavaScript to calculate the total price of selected pizzas in Euros (€)
    const checkboxes = document.getElementsByName('selected_pizzas[]');
    const totalPriceDisplay = document.getElementById('total-price');


    checkboxes.forEach((checkbox) => {
      checkbox.addEventListener('change', () => {
        let totalSelectedPrice = 0;
  
        for (let i = 0; i < checkboxes.length; i++) {
          if (checkboxes[i].checked) {
            const priceElement = checkboxes[i].parentElement.querySelector('.text-sm');
            if (priceElement) {
              const priceText = priceElement.textContent.trim(); // Remove leading/trailing spaces
              const price = parseFloat(priceText.replace('€', '').replace(',', '.').trim()); // Convert €10,00 to a valid float
              if (!isNaN(price)) {
                totalSelectedPrice += price;
              }
            }
          }
        }
  
        totalPriceDisplay.textContent = `€${totalSelectedPrice.toFixed(2).replace('.', ',')}`;
      });
    });
  </script>
  
  
  
  
  
{% endblock %}
